---
title: Create a Theme Template
description: This guide walks you through adding a new template to the Noctalia Theming System.
sidebar:
  order: 5
---

This guide walks you through adding a new **Theme Template** to **Noctalia**.

The system uses the **Noctalia Template Processor**, a custom Python-based engine that generates Material Design 3 and other color palettes, and renders templates. It is fully compatible with Matugen template syntax.

---

## Overview

Adding a new template involves just two steps:

1. [Create the template file](#step-1-create-the-template-file)
2. [Register the template](#step-2-register-the-template)

---

## Step 1: Create the Template File

Create your template file in the Templates directory.
For example, if you're making a theme for an application:

**`Assets/Templates/myapp.conf`**

```ini
background = {{colors.surface.default.hex}}
foreground = {{colors.on_surface.default.hex}}
accent = {{colors.primary.default.hex}}
border = {{colors.outline.default.hex}}
```

See [Available Colors](#available-colors) for the complete list of 48 color variables.

### Template Syntax

The processor uses the syntax `{{colors.name.mode.format}}`:

- **name**: The Material Design 3 color name (see [Available Colors](#available-colors) below).
- **mode**: `default`, `dark`, or `light`. Use `default` to automatically follow the system theme mode.
- **format**: The output format. Supported formats:
  - `hex` (#RRGGBB)
  - `hex_stripped` (RRGGBB)
  - `rgb` (rgb(r, g, b))
  - `rgba` (rgba(r, g, b, a))
  - `hsl` (hsl(h, s%, l%))
  - `hsla` (hsla(h, s%, l%, a))
  - `hue`, `saturation`, `lightness` (individual HSL components)
  - `red`, `green`, `blue` (individual RGB components)
  - `alpha` (alpha value)

### Available Colors

The template processor generates a complete 48-color Material Design 3 palette:

<details>
<summary>**Primary Colors** (8)</summary>

| Color Name | Description |
|------------|-------------|
| `primary` | Main accent color |
| `on_primary` | Text/icons on primary |
| `primary_container` | Container using primary |
| `on_primary_container` | Text/icons on primary container |
| `primary_fixed` | Fixed primary (consistent across modes) |
| `primary_fixed_dim` | Dimmed fixed primary |
| `on_primary_fixed` | Text on fixed primary |
| `on_primary_fixed_variant` | Variant text on fixed primary |

</details>

<details>
<summary>**Secondary Colors** (8)</summary>

| Color Name | Description |
|------------|-------------|
| `secondary` | Secondary accent color |
| `on_secondary` | Text/icons on secondary |
| `secondary_container` | Container using secondary |
| `on_secondary_container` | Text/icons on secondary container |
| `secondary_fixed` | Fixed secondary |
| `secondary_fixed_dim` | Dimmed fixed secondary |
| `on_secondary_fixed` | Text on fixed secondary |
| `on_secondary_fixed_variant` | Variant text on fixed secondary |

</details>

<details>
<summary>**Tertiary Colors** (8)</summary>

| Color Name | Description |
|------------|-------------|
| `tertiary` | Tertiary accent color |
| `on_tertiary` | Text/icons on tertiary |
| `tertiary_container` | Container using tertiary |
| `on_tertiary_container` | Text/icons on tertiary container |
| `tertiary_fixed` | Fixed tertiary |
| `tertiary_fixed_dim` | Dimmed fixed tertiary |
| `on_tertiary_fixed` | Text on fixed tertiary |
| `on_tertiary_fixed_variant` | Variant text on fixed tertiary |

</details>

<details>
<summary>**Error Colors** (4)</summary>

| Color Name | Description |
|------------|-------------|
| `error` | Error/warning color |
| `on_error` | Text/icons on error |
| `error_container` | Container for errors |
| `on_error_container` | Text/icons on error container |

</details>

<details>
<summary>**Surface Colors** (11)</summary>

| Color Name | Description |
|------------|-------------|
| `surface` | Main background |
| `on_surface` | Primary text color |
| `surface_variant` | Alternative surface |
| `on_surface_variant` | Text on surface variant |
| `surface_dim` | Dimmed surface |
| `surface_bright` | Bright surface |
| `surface_container_lowest` | Lowest elevation container |
| `surface_container_low` | Low elevation container |
| `surface_container` | Standard container |
| `surface_container_high` | High elevation container |
| `surface_container_highest` | Highest elevation container |

</details>

<details>
<summary>**Outline & Utility Colors** (4)</summary>

| Color Name | Description |
|------------|-------------|
| `outline` | Border/divider color |
| `outline_variant` | Subtle outline variant |
| `shadow` | Shadow color |
| `scrim` | Overlay/scrim color |

</details>

<details>
<summary>**Inverse Colors** (3)</summary>

| Color Name | Description |
|------------|-------------|
| `inverse_surface` | Inverted surface |
| `inverse_on_surface` | Text on inverse surface |
| `inverse_primary` | Inverted primary |

</details>

<details>
<summary>**Background Colors** (2)</summary>

| Color Name | Description |
|------------|-------------|
| `background` | Background (alias for surface) |
| `on_background` | Text on background |

</details>

### Filters

You can pipe colors through filters using the `|` syntax:

```ini
color0 {{colors.primary.default.hex | lighten 10}}
color1 {{colors.surface.default.hex | set_alpha 0.5}}
color2 {{colors.error.default.hex | grayscale}}
```

Multiple filters can be chained:

```ini
accent {{colors.primary.default.hex | lighten 10 | set_alpha 0.8}}
```

#### Color Filters

| Filter | Argument | Description |
|--------|----------|-------------|
| `grayscale` | none | Convert to grayscale |
| `invert` | none | Invert the color |
| `lighten` | percentage (0-100) | Increase lightness |
| `darken` | percentage (0-100) | Decrease lightness |
| `saturate` | percentage (0-100) | Increase saturation |
| `desaturate` | percentage (0-100) | Decrease saturation |
| `set_alpha` | float (0.0-1.0) | Set alpha/opacity |
| `set_lightness` | percentage (0-100) | Set absolute lightness |
| `set_saturation` | percentage (0-100) | Set absolute saturation |
| `set_hue` | degrees (0-360) | Set absolute hue |
| `set_red` | value (0-255) | Set red channel |
| `set_green` | value (0-255) | Set green channel |
| `set_blue` | value (0-255) | Set blue channel |
| `auto_lightness` | percentage | Lighten if dark, darken if light |
| `blend` | `"#hex", amount` | Blend hue toward target color |
| `harmonize` | `"#hex"` | M3 harmonize (max 15Â° hue shift) |

#### String Filters

| Filter | Description |
|--------|-------------|
| `lower_case` | Convert to lowercase |
| `camel_case` | Convert to camelCase |
| `pascal_case` | Convert to PascalCase |
| `snake_case` | Convert to snake_case |
| `kebab_case` | Convert to kebab-case |
| `replace: "find", "replace"` | String replacement |

### Block Constructs

The template processor supports control flow blocks using `<* ... *>` syntax.

#### For Loops

Iterate over colors or ranges:

```
<* for name, value in colors *>
  --color-{{name}}: {{value.default.hex}};
<* endfor *>
```

**Available iterables:**
- `colors` - All 48 color name/value pairs
- `palettes.primary`, `palettes.secondary`, `palettes.tertiary`, `palettes.error`, `palettes.neutral`, `palettes.neutral_variant` - Tonal palette entries (17 tones: 0-100)
- `0..10` - Numeric ranges

**Loop variables:**
- `loop.index` - Current iteration index (0-based)
- `loop.first` - `true` if first iteration
- `loop.last` - `true` if last iteration

#### Conditionals

```
<* if {{ loop.first }} *>
  /* First item */
<* else *>
  /* Other items */
<* endif *>

<* if not {{ loop.last }} *>
  ,
<* endif *>
```

### Special Tags

| Tag | Description |
|-----|-------------|
| `{{image}}` | Path to source wallpaper image |

### Custom Colors (TOML Config)

Define custom colors in your TOML config that generate full M3 token sets:

```toml
[config.custom_colors]
warning = "#FFA500"
success = { color = "#00FF00", blend = true }
```

Each custom color generates 6 tokens per mode:
- `{name}`, `on_{name}`
- `{name}_container`, `on_{name}_container`
- `{name}_source`, `{name}_value`

When `blend = true` (default), the color is harmonized toward the primary color.

---

## Step 2: Register the Template

You need to tell the system about your template. Open **`Services/Theming/TemplateRegistry.qml`**.

There are two main categories: **Terminals** and **Applications**.

### For Terminal Emulators
Add to the `terminals` array:

```qml
{
  "id": "kitty",
  "name": "Kitty",
  "templatePath": "terminal/kitty.conf",
  "outputPath": "~/.config/kitty/themes/noctalia.conf",
  "postHook": `${templateApplyScript} kitty`
}
```

**Properties:**
- **`id`** - Unique identifier used in settings
- **`name`** - Display name in the UI
- **`templatePath`** - Relative path from `Assets/Templates/`
- **`outputPath`** - Destination path (`~` is expanded to home directory)
- **`postHook`** - Shell command to run after generation (e.g., to reload the terminal)

### For Applications
Add to the `applications` array:

```qml
{
  "id": "myapp",
  "name": "My App",
  "category": "misc", // See categories below
  "input": "myapp.conf",
  "outputs": [
    {
      "path": "~/.config/myapp/themes/noctalia.conf"
    }
  ],
  // Optional: Run a command after generating colors (e.g. to reload the app)
  "postProcess": (mode) => `${templateApplyScript} myapp`
}
```

**Properties:**
- **`id`** - Unique identifier used in settings
- **`name`** - Display name in the UI
- **`category`** - Category for organization (see below)
- **`input`** - Template filename in `Assets/Templates/`
- **`outputs`** - Array of output destinations, each with a `path` property
- **`postProcess`** - Optional function receiving the current mode (`"dark"` or `"light"`)

**Advanced output options:**
```qml
"outputs": [
  {
    "path": "~/.config/myapp/themes/noctalia.conf",
    "input": "myapp-alternate.conf" // Override input for this output
  }
]
```

**Additional flags:**
- **`dualMode: true`** - Template contains both dark and light theme patterns (e.g., zed.json)
- **`strict: true`** - Use strict mode for palette generation (preserves custom surface/outline values)

Once registered:
1. The template will automatically appear in **Settings > Color Scheme > Templates**.
2. The UI will automatically show the target path in the tooltip.
3. The state (enabled/disabled) is automatically saved in `Settings.qml`.

### Multi-Client Applications

Some applications have multiple variants (e.g., Discord forks, VS Code variants). Use the `clients` array pattern:

```qml
{
  "id": "discord",
  "name": "Discord",
  "category": "misc",
  "input": ["discord-midnight.css", "discord-material.css"],
  "clients": [
    { "name": "vesktop", "path": "~/.config/vesktop" },
    { "name": "webcord", "path": "~/.config/webcord" },
    { "name": "equibop", "path": "~/.config/equibop" }
  ]
}
```

For multi-client apps:
- **`input`** can be an array of template files (generates multiple themes per client)
- **`clients`** array defines the different application variants
- Each client has a `name` (identifier) and `path` (config directory)
- Clients are auto-detected by `ProgramCheckerService` - only detected clients receive themes

**Existing multi-client apps:**
- **Discord** - vesktop, webcord, armcord, equibop, equicord, lightcord, dorion, vencord, betterdiscord
- **Code** - code (VS Code), codium (VSCodium)
- **Emacs** - doom, modern (~/.config/emacs), traditional (~/.emacs.d)

---

## Template Categories

Use the `category` property to organize your template in the settings UI:

- `system` (GTK, Qt, KDE)
- `terminal` (Terminal emulators - automatically assigned for `terminals` array)
- `launcher` (App launchers)
- `browser` (Web browsers)
- `editor` (Code editors)
- `audio` (Music players, visualizers)
- `compositor` (Hyprland, Niri, etc.)
- `misc` (Everything else)

---

## How Color Generation Works

Noctalia uses `template-processor.py` to handle all color generation and template rendering.

### 1. Wallpaper Analysis
When "Wallpaper Colors" is enabled, the processor analyzes the current wallpaper image. It uses:
- **Quantization**: Extracts dominant colors using the Wu quantizer (same as Android/Matugen).
- **Scoring**: Ranks colors based on chroma and population to find the best seed color.
- **Palette Generation**: Creates a full palette from the one or more seeds color.

### 2. Predefined Schemes
When using a predefined scheme (e.g., Nord, Dracula), the processor:
- Loads the scheme's core colors.
- Generates the missing Material Design 3 tokens to ensure a complete palette.
- This allows any legacy scheme to work with modern Material Design 3 templates.

### 3. Rendering
The processor takes the generated palette and renders all enabled templates. It parses the `{{...}}` tags, applies any filters, and writes the output files to their destinations.

---

## Scheme Types (Palette Generation Methods)

When using wallpaper colors, you can choose different palette generation algorithms. These are configured in **Settings > Color Scheme > Generation Method**.

| Scheme Type | Description |
|-------------|-------------|
| **M3-Tonal Spot** | Default Material Design 3 algorithm with tonal variations |
| **M3-Content** | Emphasizes content colors from the source |
| **M3-Fruit Salad** | More vibrant, varied color selection |
| **M3-Rainbow** | Full spectrum rainbow-based palette |
| **M3-Monochrome** | Single-hue variations for minimalist themes |
| **Vibrant** | Maximizes saturation for bold colors |
| **Faithful** | Stays closer to source image colors |
| **Muted** | Desaturated, subtle color palette |

---

## User Templates

Users can create their own templates without modifying the codebase:

1. Enable "User Templates" in **Settings > Color Scheme > Templates**.
2. This creates a `user-templates.toml` in `~/.config/noctalia/`.
3. Edit this TOML file to add custom templates.

```toml
[config]

[templates]
# Add your custom templates below

[templates.myapp]
input_path = "~/.config/noctalia/templates/myapp.css"
output_path = "~/.config/myapp/theme.css"
post_hook = "myapp --reload-theme"
```

**User template properties:**
- **`input_path`** - Absolute path to your template file
- **`output_path`** - Where to write the generated theme
- **`post_hook`** - Optional command to run after generation (e.g., reload app)

User templates are processed whenever the theme changes, using the same template syntax as built-in templates.
